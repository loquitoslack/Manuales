Samba en centos

Install samba Centos
---------------------
yum -y install samba samba-client samba-common

Config Samba in iptables/shorewall 
----------------------------------

### Añadir iptables 
iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 135:139 -j ACCEPT
iptables -A INPUT -m state --state NEW -m udp -p udp --dport 135:139 -j ACCEPT
iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 445 -j ACCEPT

### Guarde los cambios
service iptables save

### Shorewall.

###Edite el archivo /etc/shorewall/rules:

vi /etc/shorewall/rules
#ACTION	SOURCE	DEST	PROTO 	DEST		SOURCE
#				PORT		PORT(S)1
ACCEPT	all	fw	tcp	135:139,445
ACCEPT	all	fw	udp	135:139

#ACTION	SOURCE	DEST	PROTO 	DEST		SOURCE
#				PORT		PORT(S)1
ACCEPT	loc	fw	tcp	135:139,445
ACCEPT	loc	fw	udp	135:139

### Actualice los cambios
service shorewall restart

SELinux y el servicio smb.
--------------------------

Políticas más comunes y contextos utilizados
############################################

Permite compartir todos los recursos en modo de sólo lectura
------------------------------------------------------------

setsebool -P samba_export_all_ro 1

Permite compartir todos los recursos en modo de lectura y escritura:
setsebool -P samba_export_all_rw 1

Para cualquiera de las dos políticas anteriores: los archivos y directorios a compartir requieren el contexto samba_share_t. Ejemplo:

mkdir -p /srv/samba/ejemplo 
chcon -t samba_share_t /srv/samba/ejemplo

Ejecute semanage con fcontext como argumento, la opción -a, la opción -t con samba_share_t como argumento y el directorio o archivo de destino como último argumento para establecer este contexto como el predeterminado para éste:

semanage fcontext -a -t samba_share_t /srv/samba/ejemplo

Lo anterior permitirá establecer los contextos establecidos como los predeterminados para cada directorio o archivo definido.

Permitir la escritura como usuario anónimo:
-------------------------------------------
setsebool -P allow_smbd_anon_write 1

Lo anterior requiere que los archivos y directorios involucrados tengan el contexto public_content_rw_t. Ejemplo:

mkdir -p /srv/samba/publico
chown nobody:nobody /srv/samba/publico
chcon -t public_content_rw_t /srv/samba/publico

Ejecute semanage con fcontext como argumento, la opción -a, la opción -t con public_content_rw_t como argumento y el directorio o archivo de destino como último argumento para establecer este contexto como el predeterminado para éste:

semanage fcontext -a -t public_content_rw_t /srv/samba/ejemplo

Políticas para los directorios de inicio
########################################

permite compartir a través de Samba los directorios de inicio de los usuarios del anfitrión local
-------------------------------------------------------------------------------------------------

setsebool -P samba_enable_home_dirs 1

permite utilizar los directorios de inicio de un servidor Samba remoto como los directorios de inicio del anfitrión local:

setsebool -P use_samba_home_dirs 1

Políticas específicas para Controlador Primario de Dominio
##########################################################

A fin de que SELinux permita al servicio smb crear nuevos directorios de inicio para los usuarios a través de PAM (operación común en Controladores Primarios de Dominio), ejecute:

setsebool -P samba_create_home_dirs 1

Ejecute lo siguiente para permitir el funcionamiento como Controlador Primario de Dominio (PDC, Primary Domain Controler):
setsebool -P samba_domain_controller 1

Ejecute lo siguiente para permitir el funcionamiento como un organizador de mapa de puertos (portmappper):
setsebool -P samba_portmapper 1

Ejecute lo siguiente para permitir la ejecución sin confinamiento de programas dentro del directorio /var/lib/samba/scripts:
setsebool -P samba_run_unconfined 1